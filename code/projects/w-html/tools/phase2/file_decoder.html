<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Decrypt File</title>
</head>
<body>
  <h2>Decrypt Base64</h2>
  <textarea id="base64Input" rows="10" cols="80" placeholder="Paste base64 blob..."></textarea><br><br>
  <input type="password" id="password" placeholder="Enter password"><br><br>
  <button onclick="decrypt()">Decrypt</button>
  <p id="status"></p>

  <script>
    async function decrypt() {
      const base64 = document.getElementById("base64Input").value;
      const password = document.getElementById("password").value;
      const binary = Uint8Array.from(atob(base64), c => c.charCodeAt(0));

      const salt = binary.slice(0, 16);
      const iv = binary.slice(16, 28);
      const data = binary.slice(28);

      const encoder = new TextEncoder();
      const keyMaterial = await window.crypto.subtle.importKey(
        "raw", encoder.encode(password), "PBKDF2", false, ["deriveKey"]
      );

      const key = await window.crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt: salt,
          iterations: 100000,
          hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["decrypt"]
      );

      try {
        const decrypted = await window.crypto.subtle.decrypt(
          { name: "AES-GCM", iv: iv },
          key,
          data
        );

        const blob = new Blob([decrypted]);
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "decrypted_file";
        a.click();
        document.getElementById("status").innerText = "Success! File downloaded.";
      } catch (e) {
        document.getElementById("status").innerText = "Decryption failed.";
      }
    }
  </script>
</body>
</html>
