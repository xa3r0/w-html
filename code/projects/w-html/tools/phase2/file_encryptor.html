<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Encrypt File to Base64</title>
</head>
<body>
  <h2>Encrypt File</h2>
  <input type="file" id="fileInput"><br><br>
  <input type="password" id="password" placeholder="Enter password"><br><br>
  <button onclick="encryptFile()">Encrypt</button>
  <pre id="output"></pre>

  <script>
    async function encryptFile() {
      const file = document.getElementById("fileInput").files[0];
      const password = document.getElementById("password").value;

      if (!file || !password) {
        alert("Please select a file and enter a password.");
        return;
      }

      const fileData = await file.arrayBuffer();
      const encoder = new TextEncoder();
      const keyMaterial = await window.crypto.subtle.importKey(
        "raw", encoder.encode(password), "PBKDF2", false, ["deriveKey"]
      );

      const salt = window.crypto.getRandomValues(new Uint8Array(16));
      const key = await window.crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt: salt,
          iterations: 100000,
          hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt"]
      );

      const iv = window.crypto.getRandomValues(new Uint8Array(12));
      const encrypted = await window.crypto.subtle.encrypt(
        { name: "AES-GCM", iv: iv },
        key,
        fileData
      );

      const result = new Uint8Array([...salt, ...iv, ...new Uint8Array(encrypted)]);
      const base64 = btoa(String.fromCharCode(...result));
      document.getElementById("output").innerText = base64;
    }
  </script>
</body>
</html>
